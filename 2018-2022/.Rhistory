NA_ADI_CT_2015 <- data.frame(GEOID = names(NA_ADI_CT_2015_vec), NA_ADI = as.numeric(NA_ADI_CT_2015_vec),  row.names = NULL)
NA_ADI_CT_2015$NA_ADI <- round(NA_ADI_CT_2015$NA_ADI, digits = 0)
if (any(is.na(NA_ADI_CT_2015$NA_ADI))) {
warning("Some tract-level NA-ADI values are NA after aggregation.")
}
load(url("https://raw.githubusercontent.com/ngladish/ReADI/main/2011-2015/ReADI_CT_2015.RData"))
ADI_Mortality_Data <- read.csv("https://raw.githubusercontent.com/ngladish/Publications/main/Gladish_2025_ReADI_Creation/USALEEP_Mortality/US_A.csv", colClasses = c(Tract.ID = "character"), stringsAsFactors = FALSE)
ADI_Mortality_Data$GEOID <- ADI_Mortality_Data$Tract.ID
stopifnot(all(nchar(ADI_Mortality_Data$GEOID) == 11),
length(unique(ADI_Mortality_Data$GEOID)) == nrow(ADI_Mortality_Data))
ADI_Mortality_Data <- ADI_Mortality_Data[, c("GEOID", "e.0.")]
names(ADI_Mortality_Data)[names(ADI_Mortality_Data) == "e.0."] <- "Life_Expectancy"
common_geoids <- Reduce(intersect, list(ADI_Mortality_Data$GEOID, NA_ADI_CT_2015$GEOID, ReADI_CT_2015$GEOID))
ADI_Mortality_Data <- ADI_Mortality_Data[ADI_Mortality_Data$GEOID %in% common_geoids, ]
NA_ADI_2015_sub    <- NA_ADI_CT_2015[NA_ADI_CT_2015$GEOID %in% common_geoids, c("GEOID", "NA_ADI")]
ReADI_2015_sub     <- ReADI_CT_2015[ReADI_CT_2015$GEOID %in% common_geoids, c("GEOID", "ReADI_CT_NR")]
ADI_Mortality_Data <- plyr::join(ADI_Mortality_Data, NA_ADI_2015_sub, by = "GEOID")
ADI_Mortality_Data <- plyr::join(ADI_Mortality_Data, ReADI_2015_sub, by = "GEOID")
names(ADI_Mortality_Data)[names(ADI_Mortality_Data) == "NA_ADI"] <- "NA_ADI_CT_NR"
#save(ADI_Mortality_Data, file = "ADI_Mortality_Data.RData")
states <- setdiff(unique(fips_codes$state_code), c("60", "66", "69", "74", "78")) # Removing US territories
Pop_Total_2015 <- do.call(rbind, lapply(states, function(st){
get_acs(
year = 2015,
geography = "tract",
state = st,
key = Sys.getenv("CENSUS_API_KEY"),
variables = "B00001_001E")
}))
Pop_Total_2015 <- Pop_Total_2015 %>% tidyr::separate(NAME, c("Tract", "County", "State"), sep = ",")
names(Pop_Total_2015)[names(Pop_Total_2015) == "estimate"] <- "Pop_Total_2015"
Pop_Total_2015$variable <- NULL
Pop_Total_2015 <- Pop_Total_2015[, c("GEOID", "Pop_Total_2015")]
dat <- ADI_Mortality_Data %>%
mutate(NA_ReADI_2015_Diff = NA_ADI_CT_NR - ReADI_CT_NR) %>%
plyr::join(Pop_Total_2015, by = "GEOID") %>%
tidyr::drop_na(Life_Expectancy, NA_ADI_CT_NR, ReADI_CT_NR, Pop_Total_2015) %>%
mutate(Pop_Total_2015 = log(Pop_Total_2015), abs_diff = abs(NA_ReADI_2015_Diff), bin = cut(abs_diff, breaks = c(0, 10, 20, 40, 100), labels = c("0–9","10–19","20–39","40–100"), right  = FALSE))
View(dat)
table(dat$bin)
r2 <- summary(lm(CBG ~ NA_ADI, data = ADI_2022_Wt))$r.squared
ci <- ci.R2(R2 = r2, df.1 = 1, df.2 = nrow(ADI_2022_Wt) - 1 - 1, conf.level = 0.95)
A <- paste("CBG weights lm(ReADI ~ NA-ADI) results: ", round(r2, 3), " [95% CI, ", round(ci[[1]], 3), "-", round(ci[[3]], 3), "]", sep = "")
A
r2 <- summary(lm(CT ~ NA_ADI, data = ADI_2022_Wt))$r.squared
ci <- ci.R2(R2 = r2, df.1 = 1, df.2 = nrow(ADI_2022_Wt) - 1 - 1, conf.level = 0.95)
paste(round(r2, 3), " [95% CI, ", round(ci[[1]], 3), "-", round(ci[[3]], 3), "]", sep = "")
B <- paste("CT weights lm(ReADI ~ NA-ADI) results: ", round(r2, 3), " [95% CI, ", round(ci[[1]], 3), "-", round(ci[[3]], 3), "]", sep = "")
B
r2 <- summary(lm(C ~ NA_ADI, data = ADI_2022_Wt))$r.squared
ci <- ci.R2(R2 = r2, df.1 = 1, df.2 = nrow(ADI_2022_Wt) - 1 - 1, conf.level = 0.95)
C <- paste("CT weights lm(ReADI ~ NA-ADI) results: ", round(r2, 3), " [95% CI, ", round(ci[[1]], 3), "-", round(ci[[3]], 3), "]", sep = "")
D <- paste("Range of all NA-ADI weights: ", round(range(ADI_2022_Wt$NA_ADI), 3), sep = "")
E <- paste("Range of all ReADI weights: ", round(range(ADI_2022_Wt$CBG, ADI_2022_Wt$CT, ADI_2022_Wt$C), 3), sep = "")
D
round(range(ADI_2022_Wt$NA_ADI), 3)
round(min(ADI_2022_Wt$NA_ADI), 3)
paste("Range of all NA-ADI weights: ", round(min(ADI_2022_Wt$NA_ADI), 3), " to ", round(max(ADI_2022_Wt$NA_ADI), 3), sep = "")
paste("Range of all ReADI weights: ", round(min(ADI_2022_Wt$CBG, ADI_2022_Wt$CT, ADI_2022_Wt$C), 3), " to ", round(max(ADI_2022_Wt$CBG, ADI_2022_Wt$CT, ADI_2022_Wt$C), 3), sep = "")
### ReADI
#### Linear regression
r2_cbg <- summary(lm(ReADI_Cor ~ ReADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]))$r.squared
ci_cbg <- ci.R2(R2 = r2_cbg, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]) - 1 - 1, conf.level = 0.95)
set.seed(3756)
r2_ct <- summary(lm(ReADI_Cor ~ ReADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]))$r.squared
ci_ct <- ci.R2(R2 = r2_ct, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]) - 1 - 1, conf.level = 0.95)
set.seed(3756)
r2_c <- summary(lm(ReADI_Cor ~ ReADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "C", ]))$r.squared
ci_c <- ci.R2(R2 = r2_c, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "C", ]) - 1 - 1, conf.level = 0.95)
r2 <- min(r2_cbg, r2_ct, r2_c)
cil <- min(ci_cbg[[1]], ci_ct[[1]], ci_c[[1]])
ciu <- max(ci_cbg[[3]], ci_ct[[3]], ci_c[[3]])
A <- paste("Range of lm(cor(ReADI ~ Components) ~ Loadings): R^2 ≥ ", round(r2,3), " [95% CI, ", round(cil, 3), "-", round(ciu,3), "]", sep = "")
#### RMSE
rmse_stat <- function(data, indices) {
d <- data[indices, ]
Metrics::rmse(d$ReADI_Cor, d$ReADI_Loadings)}
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]
rmse_cbg <- Metrics::rmse(sub$ReADI_Cor, sub$ReADI_Loadings)
set.seed(2374)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_cbg <- boot.ci(b, type = c("perc"))$percent
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]
rmse_ct <- Metrics::rmse(sub$ReADI_Cor, sub$ReADI_Loadings)
set.seed(2374)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_ct <- boot.ci(b, type = c("perc"))$percent
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "C", ]
rmse_c <- Metrics::rmse(sub$ReADI_Cor, sub$ReADI_Loadings)
set.seed(2374)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_c <- boot.ci(b, type = c("perc"))$percent
rsme <- min(rmse_cbg, rmse_ct, rmse_c)
cil <- min(ci_cbg[4], ci_ct[4], ci_c[4])
ciu <- min(ci_cbg[5], ci_ct[5], ci_c[5])
B <- paste("Minimum of RMSE(cor(ReADI ~ Components) ~ Loadings): ", round(rsme,3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
rsme <- max(rmse_cbg, rmse_ct, rmse_c)
cil <- max(ci_cbg[4], ci_ct[4], ci_c[4])
ciu <- max(ci_cbg[5], ci_ct[5], ci_c[5])
C <- paste("Maximum of RMSE(cor(ReADI ~ Components) ~ Loadings): ", round(rsme,3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
## For Figure 2A:
D <- paste("Figure 2A (ReADI CBG): R^2 = ", round(r2_cbg,3), " (RMSE, ", round(rmse_cbg, 3), ")", sep = "")
E <- paste("Figure 2A (ReADI CT): R^2 = ", round(r2_ct,3), " (RMSE, ", round(rmse_ct, 3), ")", sep = "")
G <- paste("Figure 2A (ReADI C): R^2 = ", round(r2_c,3), " (RMSE, ", round(rmse_c, 3), ")", sep = "")
### NA-ADI
#### Linear regression
set.seed(3756)
r2_cbg <- summary(lm(NA_Cor ~ NA_ADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]))$r.squared
ci_cbg <- ci.R2(R2 = r2_cbg, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]) - 1 - 1, conf.level = 0.95)
set.seed(3756)
r2_ct <- summary(lm(NA_Cor ~ NA_ADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]))$r.squared
ci_ct <- ci.R2(R2 = r2_ct, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]) - 1 - 1, conf.level = 0.95)
set.seed(3756)
r2_c <- summary(lm(NA_Cor ~ NA_ADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "C", ]))$r.squared
ci_c <- ci.R2(R2 = r2_c, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "C", ]) - 1 - 1, conf.level = 0.95)
r2 <- min(r2_cbg, r2_ct, r2_c)
cil <- min(ci_cbg[[1]], ci_ct[[1]], ci_c[[1]])
ciu <- min(ci_cbg[[3]], ci_ct[[3]], ci_c[[3]])
H <- paste("Minimum of lm(cor(NA-ADI ~ Components) ~ Loadings): ", round(r2, 3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
r2 <- max(r2_cbg, r2_ct, r2_c)
cil <- max(ci_cbg[[1]], ci_ct[[1]], ci_c[[1]])
ciu <- max(ci_cbg[[3]], ci_ct[[3]], ci_c[[3]])
I <- paste("Maximum of lm(cor(NA-ADI ~ Components) ~ Loadings): ", round(r2, 3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
#### RMSE
rmse_stat <- function(data, indices) {
d <- data[indices, ]
Metrics::rmse(d$NA_Cor, d$NA_ADI_Loadings)}
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]
rmse_cbg <- Metrics::rmse(sub$NA_Cor, sub$NA_ADI_Loadings)
set.seed(3756)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_cbg <- boot.ci(b, type = c("perc"))$percent
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]
rmse_ct <- Metrics::rmse(sub$NA_Cor, sub$NA_ADI_Loadings)
set.seed(3756)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_ct <- boot.ci(b, type = c("perc"))$percent
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "C", ]
rmse_c <- Metrics::rmse(sub$NA_Cor, sub$NA_ADI_Loadings)
set.seed(3756)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_c <- boot.ci(b, type = c("perc"))$percent
rsme <- min(rmse_cbg, rmse_ct, rmse_c)
cil <- min(ci_cbg[4], ci_ct[4], ci_c[4])
ciu <- min(ci_cbg[5], ci_ct[5], ci_c[5])
H <- paste("Minimum of RMSE(cor(NA-ADI ~ Components) ~ Loadings): ", round(rsme,3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
rsme <- max(rmse_cbg, rmse_ct, rmse_c)
cil <- max(ci_cbg[4], ci_ct[4], ci_c[4])
ciu <- max(ci_cbg[5], ci_ct[5], ci_c[5])
I <- paste("Maximum of RMSE(cor(NA-ADI ~ Components) ~ Loadings): ", round(rsme,3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
## For Figure 2B:
J <- paste("Figure 2B (NA-ADI CBG): R^2 = ", round(r2_cbg,3), " (RMSE, ", round(rmse_cbg, 3), ")", sep = "")
K <- paste("Figure 2B (NA-ADI CT): R^2 = ", round(r2_ct,3), " (RMSE, ", round(rmse_ct, 3), ")", sep = "")
L <- paste("Figure 2B (NA-ADI C): R^2 = ", round(r2_c,3), " (RMSE, ", round(rmse_c, 3), ")", sep = "")
A
B
C
D
E
G
H
I
J
K
L
### ReADI
#### Linear regression
r2_cbg <- summary(lm(ReADI_Cor ~ ReADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]))$r.squared
ci_cbg <- ci.R2(R2 = r2_cbg, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]) - 1 - 1, conf.level = 0.95)
set.seed(3756)
r2_ct <- summary(lm(ReADI_Cor ~ ReADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]))$r.squared
ci_ct <- ci.R2(R2 = r2_ct, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]) - 1 - 1, conf.level = 0.95)
set.seed(3756)
r2_c <- summary(lm(ReADI_Cor ~ ReADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "C", ]))$r.squared
ci_c <- ci.R2(R2 = r2_c, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "C", ]) - 1 - 1, conf.level = 0.95)
r2 <- min(r2_cbg, r2_ct, r2_c)
cil <- min(ci_cbg[[1]], ci_ct[[1]], ci_c[[1]])
ciu <- max(ci_cbg[[3]], ci_ct[[3]], ci_c[[3]])
A <- paste("Range of lm(cor(ReADI ~ Components) ~ Loadings): R^2 ≥ ", round(r2,3), " [95% CI, ", round(cil, 3), "-", round(ciu,3), "]", sep = "")
#### RMSE
rmse_stat <- function(data, indices) {
d <- data[indices, ]
Metrics::rmse(d$ReADI_Cor, d$ReADI_Loadings)}
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]
rmse_cbg <- Metrics::rmse(sub$ReADI_Cor, sub$ReADI_Loadings)
set.seed(2374)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_cbg <- boot.ci(b, type = c("perc"))$percent
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]
rmse_ct <- Metrics::rmse(sub$ReADI_Cor, sub$ReADI_Loadings)
set.seed(2374)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_ct <- boot.ci(b, type = c("perc"))$percent
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "C", ]
rmse_c <- Metrics::rmse(sub$ReADI_Cor, sub$ReADI_Loadings)
set.seed(2374)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_c <- boot.ci(b, type = c("perc"))$percent
rsme <- min(rmse_cbg, rmse_ct, rmse_c)
cil <- min(ci_cbg[4], ci_ct[4], ci_c[4])
ciu <- min(ci_cbg[5], ci_ct[5], ci_c[5])
B <- paste("Minimum of RMSE(cor(ReADI ~ Components) ~ Loadings): ", round(rsme,3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
rsme <- max(rmse_cbg, rmse_ct, rmse_c)
cil <- max(ci_cbg[4], ci_ct[4], ci_c[4])
ciu <- max(ci_cbg[5], ci_ct[5], ci_c[5])
C <- paste("Maximum of RMSE(cor(ReADI ~ Components) ~ Loadings): ", round(rsme,3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
## For Figure 2A:
D <- paste("Figure 2A (ReADI CBG): R^2 = ", round(r2_cbg,3), " (RMSE, ", round(rmse_cbg, 3), ")", sep = "")
E <- paste("Figure 2A (ReADI CT): R^2 = ", round(r2_ct,3), " (RMSE, ", round(rmse_ct, 3), ")", sep = "")
G <- paste("Figure 2A (ReADI C): R^2 = ", round(r2_c,3), " (RMSE, ", round(rmse_c, 3), ")", sep = "")
### NA-ADI
#### Linear regression
set.seed(3756)
r2_cbg <- summary(lm(NA_Cor ~ NA_ADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]))$r.squared
ci_cbg <- ci.R2(R2 = r2_cbg, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]) - 1 - 1, conf.level = 0.95)
set.seed(3756)
r2_ct <- summary(lm(NA_Cor ~ NA_ADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]))$r.squared
ci_ct <- ci.R2(R2 = r2_ct, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]) - 1 - 1, conf.level = 0.95)
set.seed(3756)
r2_c <- summary(lm(NA_Cor ~ NA_ADI_Loadings, data = ADI_Cor_L[ADI_Cor_L$Geo == "C", ]))$r.squared
ci_c <- ci.R2(R2 = r2_c, df.1 = 1, df.2 = nrow(ADI_Cor_L[ADI_Cor_L$Geo == "C", ]) - 1 - 1, conf.level = 0.95)
r2 <- min(r2_cbg, r2_ct, r2_c)
cil <- min(ci_cbg[[1]], ci_ct[[1]], ci_c[[1]])
ciu <- min(ci_cbg[[3]], ci_ct[[3]], ci_c[[3]])
H <- paste("Minimum of lm(cor(NA-ADI ~ Components) ~ Loadings): ", round(r2, 3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
r2 <- max(r2_cbg, r2_ct, r2_c)
cil <- max(ci_cbg[[1]], ci_ct[[1]], ci_c[[1]])
ciu <- max(ci_cbg[[3]], ci_ct[[3]], ci_c[[3]])
I <- paste("Maximum of lm(cor(NA-ADI ~ Components) ~ Loadings): ", round(r2, 3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
#### RMSE
rmse_stat <- function(data, indices) {
d <- data[indices, ]
Metrics::rmse(d$NA_Cor, d$NA_ADI_Loadings)}
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "CBG", ]
rmse_cbg <- Metrics::rmse(sub$NA_Cor, sub$NA_ADI_Loadings)
set.seed(3756)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_cbg <- boot.ci(b, type = c("perc"))$percent
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "CT", ]
rmse_ct <- Metrics::rmse(sub$NA_Cor, sub$NA_ADI_Loadings)
set.seed(3756)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_ct <- boot.ci(b, type = c("perc"))$percent
sub <- ADI_Cor_L[ADI_Cor_L$Geo == "C", ]
rmse_c <- Metrics::rmse(sub$NA_Cor, sub$NA_ADI_Loadings)
set.seed(3756)
b <- boot(sub, statistic = rmse_stat, R = 2000)
ci_c <- boot.ci(b, type = c("perc"))$percent
rsme <- min(rmse_cbg, rmse_ct, rmse_c)
cil <- min(ci_cbg[4], ci_ct[4], ci_c[4])
ciu <- min(ci_cbg[5], ci_ct[5], ci_c[5])
J <- paste("Minimum of RMSE(cor(NA-ADI ~ Components) ~ Loadings): ", round(rsme,3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
rsme <- max(rmse_cbg, rmse_ct, rmse_c)
cil <- max(ci_cbg[4], ci_ct[4], ci_c[4])
ciu <- max(ci_cbg[5], ci_ct[5], ci_c[5])
K <- paste("Maximum of RMSE(cor(NA-ADI ~ Components) ~ Loadings): ", round(rsme,3), " [95% CI, ", round(cil, 3), "-", round(ciu, 3), "]", sep = "")
## For Figure 2B:
L <- paste("Figure 2B (NA-ADI CBG): R^2 = ", round(r2_cbg,3), " (RMSE, ", round(rmse_cbg, 3), ")", sep = "")
M <- paste("Figure 2B (NA-ADI CT): R^2 = ", round(r2_ct,3), " (RMSE, ", round(rmse_ct, 3), ")", sep = "")
N <- paste("Figure 2B (NA-ADI C): R^2 = ", round(r2_c,3), " (RMSE, ", round(rmse_c, 3), ")", sep = "")
A
B
C
D
E
G
H
I
J
K
L
M
N
load(url("https://raw.githubusercontent.com/ngladish/Publications/main/Gladish_2025_ReADI_Creation/Data/ACS_CBG_2022_Geometry.RData"))
load(url("https://raw.githubusercontent.com/ngladish/Publications/main/Gladish_2025_ReADI_Creation/Data/ACS_CT_2022_Geometry.RData"))
## Download and read Census 2020 urban area shapefile --------------------------
temp_dir <- tempdir()
zip_url <- "https://www2.census.gov/geo/tiger/TIGER2020/UAC/tl_2020_us_uac10.zip"
zip_file <- file.path(temp_dir, "urban_areas.zip")
resp <- httr::GET(zip_url, write_disk(zip_file, overwrite = TRUE))
stopifnot(httr::status_code(resp) == 200)
unzip(zip_file, exdir = temp_dir)
shp_file <- list.files(temp_dir, pattern = "\\.shp$", full.names = TRUE)
stopifnot(length(shp_file) == 1L)   # should only be the UAC shapefile
urban_areas <- sf::st_read(shp_file, quiet = TRUE)
## Align CRS ------------------------------------------------------------------
if (sf::st_crs(urban_areas) != sf::st_crs(ACS_CT_2022_Geometry)) {
urban_areas <- sf::st_transform(urban_areas, sf::st_crs(ACS_CT_2022_Geometry))}
if (sf::st_crs(ACS_CBG_2022_Geometry) != sf::st_crs(ACS_CT_2022_Geometry)) {
ACS_CBG_2022_Geometry <- sf::st_transform(ACS_CBG_2022_Geometry, sf::st_crs(ACS_CT_2022_Geometry))}
## Add urban/rural flag ---------------------------------------------
add_urban_label <- function(sf_obj, urban_sf) {
hits <- sf::st_intersects(sf_obj, urban_sf)
sf_obj$urban_label <- factor(
ifelse(lengths(hits) > 0, "Urban", "Rural"),
levels = c("Rural", "Urban"))
sf_obj}
ACS_CT_2022_Geometry  <- add_urban_label(ACS_CT_2022_Geometry,  urban_areas)
ACS_CBG_2022_Geometry <- add_urban_label(ACS_CBG_2022_Geometry, urban_areas)
## Adding regions --------------------------------------------------------
fips_crosswalk <- fips_codes %>%
distinct(state_code, state_name, state) %>%        # state = USPS abbrev
filter(state %in% c(state.abb, "DC")) %>%          # include DC explicitly
mutate(region_raw = case_when(state == "DC" ~ "South",
TRUE ~ state.region[match(state, state.abb)]),
region = dplyr::recode(region_raw, "North Central" = "Midwest")) %>%
transmute(
STATEFP    = state_code,
state_name = state_name,
region     = region)
## Tracts
ACS_CT_2022_Geometry <- ACS_CT_2022_Geometry %>%
mutate(STATEFP = substr(GEOID, 1, 2)) %>%
left_join(fips_crosswalk, by = "STATEFP")
## Block groups
ACS_CBG_2022_Geometry <- ACS_CBG_2022_Geometry %>%
mutate(STATEFP = substr(GEOID, 1, 2)) %>%
left_join(fips_crosswalk, by = "STATEFP")
## Quick sanity checks --------------------------------------------------------
table(ACS_CT_2022_Geometry$urban_label)
table(ACS_CBG_2022_Geometry$urban_label)
table(ACS_CT_2022_Geometry$region)
table(ACS_CBG_2022_Geometry$region)
table(ACS_CT_2022_Geometry$region, ACS_CT_2022_Geometry$urban_label)
table(ACS_CBG_2022_Geometry$region, ACS_CBG_2022_Geometry$urban_label)
## Combining with ADI data --------------------------------------------------------
stopifnot(anyDuplicated(ACS_CBG_2022_Geometry$GEOID) == 0, anyDuplicated(ADI_CBG_Data$GEOID) == 0, anyDuplicated(ACS_CT_2022_Geometry$GEOID) == 0, anyDuplicated(ADI_CT_Data$GEOID) == 0)
ACS_CBG_2022_Geometry <- ACS_CBG_2022_Geometry %>%
st_drop_geometry() %>%
select(GEOID, STATEFP, state_name, urban_label, region)
ADI_CBG_Data <- plyr::join(ADI_CBG_Data, ACS_CBG_2022_Geometry, by   = "GEOID", type = "left")
ACS_CT_2022_Geometry <- ACS_CT_2022_Geometry %>%
st_drop_geometry() %>%
select(GEOID, STATEFP, state_name, urban_label, region)
ADI_CT_Data <- plyr::join(ADI_CT_Data, ACS_CT_2022_Geometry, by = "GEOID", type = "left")
## Regional/urban summaries --------------------------------------------------------
CT_region_summary <- ADI_CT_Data %>%
group_by(state_name, region, urban_label) %>%
dplyr::summarise(
mean_diff = mean(Diff_NA_ReADI, na.rm = TRUE),
sd_diff = sd(Diff_NA_ReADI, na.rm = TRUE),
n_tracts = n(),
se_diff = sd_diff / sqrt(n_tracts),
.groups = "drop")
CT_region_summary <- CT_region_summary[!is.na(CT_region_summary$state_name),]
CBG_region_summary <- ADI_CBG_Data %>%
group_by(state_name, region, urban_label) %>%
dplyr::summarise(
mean_diff = mean(Diff_NA_ReADI, na.rm = TRUE),
sd_diff = sd(Diff_NA_ReADI, na.rm = TRUE),
n_cbgs = n(),
se_diff = sd_diff / sqrt(n_cbgs),
.groups = "drop")
CBG_region_summary <- CBG_region_summary[!is.na(CBG_region_summary$state_name),]
# WELCH t.test ##############################################################
## CT
### Rural vs Urban
rural <- nrow(ADI_CT_Data[ADI_CT_Data$urban_label == "Rural",])
overrep <- nrow(ADI_CT_Data[ADI_CT_Data$Diff_NA_ReADI > 0 & ADI_CT_Data$urban_label == "Rural",])
perc <- round((overrep/rural)*100,1)
mean <- t.test(Diff_NA_ReADI ~ urban_label, data = ADI_CT_Data)$estimate[["mean in group Rural"]]
sd <- sd(ADI_CT_Data[ADI_CT_Data$urban_label == "Rural", "Diff_NA_ReADI"], na.rm = TRUE)
A <- paste("N(%) areas overestimated by NA-ADI, Welch t(ADI difference ~ rurality) (CT: Rural): (", overrep, " of ", rural, " [", perc, "%]; rural mean, ", round(mean, 2), " [SD, ", round(sd, 2), "])", sep = "")
urban <- nrow(ADI_CT_Data[ADI_CT_Data$urban_label == "Urban",])
underep <- nrow(ADI_CT_Data[ADI_CT_Data$Diff_NA_ReADI > 0 & ADI_CT_Data$urban_label == "Urban",])
perc <- round((underep/urban)*100,1)
mean <- t.test(Diff_NA_ReADI ~ urban_label, data = ADI_CT_Data)$estimate[["mean in group Urban"]]
sd <- sd(ADI_CT_Data[ADI_CT_Data$urban_label == "Urban", "Diff_NA_ReADI"], na.rm = TRUE)
B <- paste("N(%) areas overestimated by NA-ADI, Welch t(ADI difference ~ rurality) (CT: Urban): (", underep, " of ", urban, " [", perc, "%]; urban mean, ", round(mean, 2), " [SD, ", round(sd, 2), "])", sep = "")
### Overall
t.test_ct <- t.test(Diff_NA_ReADI ~ urban_label, data = ADI_CT_Data)
rural_mean <- t.test_ct$estimate[["mean in group Rural"]]
urban_mean <- t.test_ct$estimate[["mean in group Urban"]]
welch <- t.test_ct$statistic
cil <- t.test_ct$conf.int[1]
ciu <- t.test_ct$conf.int[2]
pval <- ifelse(t.test_ct$p.value < 0.001, 0.001, t.test_ct$p.value)
C <- paste("Overall Welch t(ADI difference ~ rurality) (CT): (mean difference [rural-urban], ", round(rural_mean-urban_mean, 2), "; 95% CI, ", round(cil, 2), "-", round(ciu, 2), "; Welch t, ", round(welch, 1), "; P <", pval, ")", sep = "")
## CBG
### Overall
t.test_cbg <- t.test(Diff_NA_ReADI ~ urban_label, data = ADI_CBG_Data)
rural_mean <- t.test_cbg$estimate[["mean in group Rural"]]
rural_sd <- sd(ADI_CBG_Data[ADI_CBG_Data$urban_label == "Rural", "Diff_NA_ReADI"], na.rm = TRUE)
urban_mean <- t.test_cbg$estimate[["mean in group Urban"]]
urban_sd <- sd(ADI_CBG_Data[ADI_CBG_Data$urban_label == "Urban", "Diff_NA_ReADI"], na.rm = TRUE)
welch <- t.test_cbg$statistic
cil <- t.test_cbg$conf.int[1]
ciu <- t.test_cbg$conf.int[2]
pval <- ifelse(t.test_cbg$p.value < 0.001, 0.001, t.test_cbg$p.value)
D <- paste("N(%) areas overestimated by NA-ADI, Welch t(ADI difference ~ rurality) (CBG): (rural mean, ", round(rural_mean, 2), " [SD, ", round(rural_sd, 2), "]; urban mean, ", round(urban_mean, 4), " [SD, ", round(urban_sd, 2), "]; mean difference [rural-urban], ", round(rural_mean-urban_mean, 2), "; 95% CI, ", round(cil, 2), "-", round(ciu, 2), "; Welch t, ", round(welch, 1), "; P <", pval, ")", sep = "")
# Cohen d ##############################################################
ADI_CBG_Data <- ADI_CBG_Data[!is.na(ADI_CBG_Data$Diff_NA_ReADI),]
ADI_CT_Data <- ADI_CT_Data[!is.na(ADI_CT_Data$Diff_NA_ReADI),]
cd <- round(cohens_d(Diff_NA_ReADI ~ urban_label, data = ADI_CBG_Data, ci = 0.95)$Cohens_d, 2)
E <- paste("(CBG effect size(ADI Diff ~ Rurality): Cohen d = ", round(cd, 2), ")", sep = "")
cd <- round(cohens_d(Diff_NA_ReADI ~ urban_label, data = ADI_CT_Data, ci = 0.95)$Cohens_d, 2)
G <- paste("(CT effect size(ADI Diff ~ Rurality): Cohen d = ", round(cd, 2), ")", sep = "")
# Quantile regression ##############################################################
qr_model <- rq(Diff_NA_ReADI ~ urban_label, data = ADI_CT_Data, tau = c(0.25, 0.5, 0.75), method = "fn")
t25 <- qr_model$coefficients["urban_labelUrban", "tau= 0.25"]
t50 <- qr_model$coefficients["urban_labelUrban", "tau= 0.50"]
t75 <- qr_model$coefficients["urban_labelUrban", "tau= 0.75"]
H <- paste("CT quantile regression tau(ADI Diff ~ Rurality): t(25%) = ", round(t25, 1), "; t(50%) = ", round(t50, 1), "; t(75%) = ", round(t75, 1), sep = "")
qr_model <- rq(Diff_NA_ReADI ~ urban_label, data = ADI_CBG_Data, tau = c(0.25, 0.5, 0.75), method = "fn")
t25 <- qr_model$coefficients["urban_labelUrban", "tau= 0.25"]
t50 <- qr_model$coefficients["urban_labelUrban", "tau= 0.50"]
t75 <- qr_model$coefficients["urban_labelUrban", "tau= 0.75"]
I <- paste("CBG quantile regression tau(ADI Diff ~ Rurality): t(25%) = ", round(t25, 1), "; t(50%) = ", round(t50, 1), "; t(75%) = ", round(t75, 1), sep = "")
## Regional Summary
# CT ----------------------------------------
CT_urban_rural_gap <- as.data.frame(t(sapply(unique(CT_region_summary$state_name), function(state) {
# Extract per-group values
m_u <- CT_region_summary$mean_diff[CT_region_summary$state_name == state & CT_region_summary$urban_label == "Urban"]
m_r <- CT_region_summary$mean_diff[CT_region_summary$state_name == state & CT_region_summary$urban_label == "Rural"]
sd_u <- CT_region_summary$sd_diff[CT_region_summary$state_name == state & CT_region_summary$urban_label == "Urban"]
sd_r <- CT_region_summary$sd_diff[CT_region_summary$state_name == state & CT_region_summary$urban_label == "Rural"]
n_u <- CT_region_summary$n_tracts[CT_region_summary$state_name == state & CT_region_summary$urban_label == "Urban"]
n_r <- CT_region_summary$n_tracts[CT_region_summary$state_name == state & CT_region_summary$urban_label == "Rural"]
if (length(m_u) == 1 && length(m_r) == 1) {
gap <- m_u - m_r
se_gap <- sqrt((sd_u^2 / n_u) + (sd_r^2 / n_r))
ci_lower <- gap - 1.96 * se_gap
ci_upper <- gap + 1.96 * se_gap
return(c(gap = gap, se = se_gap, ci_lower = ci_lower, ci_upper = ci_upper))
} else {
return(c(gap = NA, se = NA, ci_lower = NA, ci_upper = NA))
}})))
CT_urban_rural_gap <- CT_urban_rural_gap[!is.na(CT_urban_rural_gap$gap),]
## CBG
CBG_urban_rural_gap <- as.data.frame(t(sapply(unique(CBG_region_summary$state_name), function(state) {
# Extract per-group values
m_u <- CBG_region_summary$mean_diff[CBG_region_summary$state_name == state & CBG_region_summary$urban_label == "Urban"]
m_r <- CBG_region_summary$mean_diff[CBG_region_summary$state_name == state & CBG_region_summary$urban_label == "Rural"]
sd_u <- CBG_region_summary$sd_diff[CBG_region_summary$state_name == state & CBG_region_summary$urban_label == "Urban"]
sd_r <- CBG_region_summary$sd_diff[CBG_region_summary$state_name == state & CBG_region_summary$urban_label == "Rural"]
n_u <- CBG_region_summary$n_cbgs[CBG_region_summary$state_name == state & CBG_region_summary$urban_label == "Urban"]
n_r <- CBG_region_summary$n_cbgs[CBG_region_summary$state_name == state & CBG_region_summary$urban_label == "Rural"]
# Only compute if both Urban and Rural are present
if (length(m_u) == 1 && length(m_r) == 1) {
gap <- m_u - m_r
se_gap <- sqrt((sd_u^2 / n_u) + (sd_r^2 / n_r))
ci_lower <- gap - 1.96 * se_gap
ci_upper <- gap + 1.96 * se_gap
return(c(gap = gap, se = se_gap, ci_lower = ci_lower, ci_upper = ci_upper))
} else {
return(c(gap = NA, se = NA, ci_lower = NA, ci_upper = NA))
}})))
CBG_urban_rural_gap <- CBG_urban_rural_gap[!is.na(CBG_urban_rural_gap$gap),]
CT_gap <- CT_urban_rural_gap[abs(CT_urban_rural_gap$gap) == max(abs(CT_urban_rural_gap$gap)), "gap"]
CT_cil <- CT_urban_rural_gap[abs(CT_urban_rural_gap$gap) == max(abs(CT_urban_rural_gap$gap)), "ci_lower"]
CT_ciu <- CT_urban_rural_gap[abs(CT_urban_rural_gap$gap) == max(abs(CT_urban_rural_gap$gap)), "ci_upper"]
CBG_gap <- CBG_urban_rural_gap[abs(CBG_urban_rural_gap$gap) == max(abs(CBG_urban_rural_gap$gap)), "gap"]
CBG_cil <- CBG_urban_rural_gap[abs(CBG_urban_rural_gap$gap) == max(abs(CBG_urban_rural_gap$gap)), "ci_lower"]
CBG_ciu <- CBG_urban_rural_gap[abs(CBG_urban_rural_gap$gap) == max(abs(CBG_urban_rural_gap$gap)), "ci_upper"]
J <- paste("NY state (ADI Diff ~ Rurality) statistics: (tract: ", round(CT_gap ,1) , " [95% CI, ", round(CT_cil ,1), " to ", round(CT_ciu ,1), "]; block group: ", round(CBG_gap ,1) , " [95% CI, ", round(CBG_cil ,1), " to ", round(CBG_ciu ,1), "])", sep = "")
A
B
C
D
E
G
H
I
J
ggplot(ADI_Diff_Cor, aes(x = Ord, y = Cor, fill = Variables)) +
geom_bar(stat = "identity") +
facet_wrap(~Geo, scales = "free_x", drop = T, nrow = 2) +
theme_light(base_size = 18) +
ylab("Correlation to NA-ADI Error") +
theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x = element_blank(), strip.background =element_rect(fill="#474F58"), axis.title.y=element_text(size=22), legend.title = element_text(size = 18),legend.text = element_text(size = 12)) +
guides(fill = guide_legend(override.aes = list(size = 7)))
ADI_Diff_Cor
View(ADI_Diff_Cor)
table(dat$bin)
paste("CBG N = ", nrow(ADI_CBG), "; CT N = ", nrow(ADI_CT), "; C N = ", nrow(ADI_C), sep="")
ADI_CBG <- ADI_CBG_Data[, c("ReADI_CBG_NR", "NA_ADI")]
ADI_CBG <- ADI_CBG[complete.cases(ADI_CBG),]
ADI_CBG$Geography <- "Block Group"
colnames(ADI_CBG) <- c("ReADI", "NA_ADI", "Geography")
ADI_CT <- ADI_CT_Data[, c("ReADI_CT_NR", "NA_ADI")]
ADI_CT <- ADI_CT[complete.cases(ADI_CT),]
ADI_CT$Geography <- "Census Tract"
colnames(ADI_CT) <- c("ReADI", "NA_ADI", "Geography")
ADI_C <- ADI_C_Data[, c("ReADI_C_NR", "NA_ADI")]
ADI_C <- ADI_C[complete.cases(ADI_C),]
ADI_C$Geography <- "County"
colnames(ADI_C) <- c("ReADI", "NA_ADI", "Geography")
# Ns
A <- paste("CBG N = ", nrow(ADI_CBG), "; CT N = ", nrow(ADI_CT), "; C N = ", nrow(ADI_C), sep="")
A
nrow(ADI_CBG_Data)
sum(is.na(ADI_CBG_Data))
sum(is.na(ADI_CBG_Data$ReADI_CBG_NR))
sum(is.na(ADI_CBG_Data$NA_ADI))
vars   <- c("MEDFI", "INCDIS", "BELPL", "PL150", "EDU9YR", "HSDPNHIGH", "EMPWC", "UNEMP", "MEDHV", "MEDRNT", "MEDMORT", "OWN", "SNGPNT", "NOVEH", "NOINT", "NOPLUM", "CROWD")
# CBG --------------------------------------------------------------------
load(url("https://raw.githubusercontent.com/ngladish/Publications/main/Gladish_2025_ReADI_Creation/RENA/RENA_ADI_2022_CBG_RawVars.RData"))
NA_ADI_CBG_2022 <- NA_ADI_CBG_2022[, c("GEOID", "NA_ADI")]
ADI_CBG_Data <- plyr::join(ReADI_CBG_2022, NA_ADI_CBG_2022, by = "GEOID", type = "left")
stopifnot(!anyDuplicated(ADI_CBG_Data$GEOID))
ADI_CBG_Data <- ADI_CBG_Data[, c("GEOID", vars, "POPWT", "ReADI_CBG_Raw", "ReADI_CBG_NR", "NA_ADI")]
colnames(ADI_CBG_Data) <- c("GEOID", paste0(c(vars, "POPWT"), "_Re"), "ReADI_CBG_Raw", "ReADI_CBG_NR", "NA_ADI")
ADI_CBG_Data$ReADI_CBG_NR <- as.numeric(ADI_CBG_Data$ReADI_CBG_NR)
RENA_ADI_2022_CBG_RawVars <- RENA_ADI_2022_CBG_RawVars[, c("GEOID", vars)]
colnames(RENA_ADI_2022_CBG_RawVars) <- c("GEOID", paste0(vars, "_NA"))
ADI_CBG_Data <- plyr::join(ADI_CBG_Data, RENA_ADI_2022_CBG_RawVars, by = "GEOID", type = "left")
stopifnot(!anyDuplicated(ADI_CBG_Data$GEOID))
ADI_CBG <- ADI_CBG_Data[, c("ReADI_CBG_NR", "NA_ADI")]
ADI_CBG <- ADI_CBG[complete.cases(ADI_CBG),]
ADI_CBG$Geography <- "Block Group"
setwd("~/Documents/GitHub/ReADI/2018-2022")
setwd("~/Documents/GitHub/ReADI/2018-2022")
